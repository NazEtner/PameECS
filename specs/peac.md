# PEAC 1.0.0 - PameECS Archive Format
- 値はリトルエンディアン
- 文字エンコードは少なくともASCII

ヘッダー -> サイズ情報 -> エントリ情報 -> データチャンクインデックス -> データ部分 -> フッター の順番で格納

## ヘッダー
Size = 8 Bytes

|Start byte|Size|Name|Type|Comment|
|----|----|----|----|----|
|0|4|マジックナンバー|uint8_t[4]|={'P', 'E', 'A', 'C'}|
|4|1|メジャーバージョン|uint8_t|=1|
|5|1|マイナーバージョン|uint8_t|=0|
|6|1|パッチバージョン|uint8_t|=0|
|7|1|予約済み|uint8_t|=0|

## サイズ情報
Size = 32 Bytes

|Start byte|Size|Name|Type|Comment|
|----|----|----|----|----|
|0|4|圧縮後のエントリ情報部分のサイズ|uint32_t|任意の値|
|4|4|圧縮前のエントリ情報部分のサイズ|uint32_t|任意の値|
|8|8|圧縮後のデータチャンクインデックスのサイズ|uint64_t|任意の値|
|16|8|圧縮前のデータチャンクインデックスのサイズ|uint64_t|任意の値|
|24|8|圧縮後のデータチャンクのサイズの合計|uint64_t|任意の値|

## エントリ情報
### 圧縮前のフォーマット
Size = 可変

|Start byte|Size|Name|Type|Comment|
|----|----|----|----|----|
|0|2|仮想ルート直下のエントリ数|uint16_t|N|
|2|???|エントリ 0|Entry||
|||...|||
|???|???|エントリ <N - 1>|Entry||

### Entry
Size = 可変

|Start byte|Size|Name|Type|Comment|
|----|----|----|----|----|
|0|8|エントリ(ファイル)のサイズ|uint64_t|== 0: ディレクトリ<br>!= 0: ファイル<br>任意の値|
|8|8|エントリのデータの開始位置|uint64_t|任意の値<br>エントリのサイズが0であれば無視|
|16|2|エントリ名の長さ|uint16_t|L (バイト数)|
|18|L|エントリ名|char[L]|NULL終端ではない|
|18 + L|2|子エントリ数|uint16_t|N|
|18 + L + 2|???|子エントリ 0|Entry||
|||...|||
|???|???|子エントリ <N - 1>|Entry||

### 圧縮
ZStandardで圧縮すること<br>
他のセクションとまとめての圧縮は禁止

## データチャンクインデックス
### 圧縮前のフォーマット
N : 合計チャンク数<br>
Size = N * 8 Bytes

|Start byte|Size|Name|Type|Comment|
|----|----|----|----|----|
|0|8|チャンク 0 の圧縮後のオフセット|uint64_t|=0|
|8|8|チャンク 1 の圧縮後のオフセット|uint64_t|任意の値<br>> チャンク 0 の圧縮後のオフセット|
|16|8|チャンク 2 の圧縮後のオフセット|uint64_t|任意の値<br>> チャンク 1 の圧縮後のオフセット|
|||...|||
|(N - 1) * 8|8|チャンク <N - 1> の圧縮後のオフセット|uint64_t|任意の値<br>> チャンク <N - 2> の圧縮後のオフセット|

### 圧縮
ZStandardで圧縮すること<br>
他のセクションとまとめての圧縮は禁止

## データ部分
### 圧縮前のフォーマット
N : 合計チャンク数<br>
Size = N * 2048 Bytes

|Start byte|Size|Name|Type|Comment|
|----|----|----|----|----|
|0|2048|チャンク 0|uint8_t[2048]|すべてのファイルのデータを連結したバッファの0~2047の部分|
|2048|2048|チャンク 1|uint8_t[2048]|すべてのファイルのデータを連結したバッファの2048~4095の部分|
|||...|||
|(N - 1) * 2048|2048|チャンク <N - 1>|uint8_t[2048]|このチャンクのみパディングが入る可能性がある|

### 圧縮
それぞれのチャンク毎にZStandardで圧縮すること<br>
複数のチャンクやセクションとまとめての圧縮は禁止

## フッター
Size = 8

|Start byte|Size|Name|Type|Comment|
|----|----|----|----|----|
|0|8|誤り検出|uint8_t[8]|ヘッダーとサイズ情報とフッターを除いたすべてのセクションのCRC64-ECMA|